<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistema de Gerenciamento de Contratos</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <style>
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 50;
        }

        .modal-content {
            background-color: white;
            border-radius: 0.5rem;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .notification {
            position: fixed;
            top: 1rem;
            right: 1rem;
            padding: 1rem;
            border-radius: 0.5rem;
            z-index: 100;
            animation: slideIn 0.3s ease-out;
        }

        .notification-success {
            background-color: #10B981;
            color: white;
        }

        .notification-error {
            background-color: #EF4444;
            color: white;
        }

        .btn {
            @apply px-4 py-2 rounded-md text-white transition-colors duration-200 flex items-center justify-center;
        }

        .btn-blue {
            @apply bg-blue-500 hover:bg-blue-700;
        }

        .btn-gray {
            @apply bg-gray-500 hover:bg-gray-700;
        }

        .btn-green {
            @apply bg-green-500 hover:bg-green-700;
        }

        .btn-red {
            @apply bg-red-500 hover:bg-red-700;
        }

        .btn-yellow {
            @apply bg-yellow-500 hover:bg-yellow-700;
        }

        .loading-spinner {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
        }

        .comment-box {
            @apply bg-white p-4 rounded-lg shadow-sm border border-gray-200;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #666;
        }
    </style>
</head>
<body class="bg-gray-100 min-h-screen">
    <!-- Loading Spinner -->
    <div id="loadingSpinner" class="loading-spinner hidden">
        <div class="animate-spin rounded-full h-16 w-16 border-t-2 border-b-2 border-blue-500"></div>
    </div>

    <!-- Notification -->
    <div id="notification" class="notification hidden"></div>

    <!-- Header -->
    <header class="bg-white shadow-md">
        <div class="container mx-auto px-4 py-6">
            <div class="flex justify-between items-center">
                <h1 class="text-2xl font-bold text-gray-800">Sistema de Gerenciamento de Contratos</h1>
                <div class="text-sm text-gray-600">
                    <span>Usuário: <span id="currentUser">VictorCainj</span></span>
                    <span class="mx-2">|</span>
                    <span>Data: <span id="currentDateTime">2025-01-23 04:55:23</span></span>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-8">
        <!-- Controls -->
        <div class="mb-8 space-y-4">
            <div class="flex flex-wrap gap-4 justify-between items-center">
                <button id="createNoteBtn" class="btn btn-blue">
                    <i class="fas fa-plus mr-2"></i>Criar Anotação
                </button>
                <div class="flex gap-4">
                    <button id="importNotesBtn" class="btn btn-gray">
                        <i class="fas fa-file-import mr-2"></i>Importar
                    </button>
                    <button id="downloadNotesBtn" class="btn btn-gray">
                        <i class="fas fa-file-export mr-2"></i>Exportar Tudo
                    </button>
                    <input type="file" id="fileInput" accept=".json" class="hidden">
                </div>
            </div>

            <div class="flex flex-wrap gap-4">
                <div class="flex-1 min-w-[200px]">
                    <input type="text" 
                           id="searchInput" 
                           placeholder="Pesquisar por contrato, locador/locatário ou endereço..." 
                           class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                </div>
                <select id="dateSort" 
                        class="px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <option value="newest">Mais recentes primeiro</option>
                    <option value="oldest">Mais antigos primeiro</option>
                </select>
                <select id="statusFilter" 
                        class="px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400">
                    <option value="all">Todos os status</option>
                    <option value="open">Em aberto</option>
                    <option value="closed">Finalizados</option>
                </select>
            </div>
        </div>

        <!-- Notes Container -->
        <div id="notesContainer" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4"></div>
    </main>

    <!-- Create/Edit Note Modal -->
    <div id="noteModal" class="modal-overlay hidden">
        <div class="modal-content w-full max-w-2xl p-6">
            <h2 class="text-xl font-bold mb-4">Nova Anotação</h2>
            <form id="noteForm" class="space-y-4">
                <div>
                    <label class="block text-sm font-medium text-gray-700">Número do Contrato</label>
                    <input type="text" 
                           id="contractNumber" 
                           class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" 
                           required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Locador ou Locatário</label>
                    <input type="text" 
                           id="role" 
                           class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" 
                           required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Problema</label>
                    <textarea id="problem" 
                              class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" 
                              rows="3" 
                              required></textarea>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Data do Contrato</label>
                    <input type="date" 
                           id="date" 
                           class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" 
                           required>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-700">Endereço</label>
                    <input type="text" 
                           id="address" 
                           class="mt-1 w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" 
                           required>
                </div>
                <div class="flex gap-4">
                    <button type="submit" class="btn btn-blue flex-1">
                        <i class="fas fa-save mr-2"></i>Salvar
                    </button>
                    <button type="button" id="cancelBtn" class="btn btn-gray flex-1">
                        <i class="fas fa-times mr-2"></i>Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- Note Details Modal -->
    <div id="noteDetailsModal" class="modal-overlay hidden">
        <div class="modal-content w-full max-w-4xl p-6">
            <div class="mb-6">
                <h2 class="text-xl font-bold mb-4">Detalhes da Anotação</h2>
                <div id="noteDetailsContent" class="space-y-4"></div>
            </div>

            <div class="border-t border-gray-200 pt-4">
                <h3 class="text-lg font-semibold mb-4">Comentários</h3>
                <form id="commentForm" class="mb-4">
                    <textarea id="commentText" 
                              class="w-full px-4 py-2 border rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400" 
                              rows="3" 
                              placeholder="Adicione um comentário..."
                              required></textarea>
                    <button type="submit" class="mt-2 btn btn-blue">
                        <i class="fas fa-comment mr-2"></i>Adicionar Comentário
                    </button>
                </form>
                <div id="commentsContainer" class="space-y-4 max-h-60 overflow-y-auto"></div>
            </div>

            <div class="border-t border-gray-200 mt-6 pt-4 flex gap-4">
                <button id="toggleStatusBtn" class="btn btn-green flex-1">
                    <i class="fas fa-check-circle mr-2"></i>Finalizar Chamado
                </button>
                <button id="copyDetailsBtn" class="btn btn-yellow flex-1">
                    <i class="fas fa-copy mr-2"></i>Copiar Dados
                </button>
                <button id="downloadContractBtn" class="btn btn-blue flex-1">
                    <i class="fas fa-file-download mr-2"></i>Exportar
                </button>
                <button id="deleteNoteBtn" class="btn btn-red flex-1">
                    <i class="fas fa-trash mr-2"></i>Excluir
                </button>
                <button id="closeDetailsBtn" class="btn btn-gray flex-1">
                    <i class="fas fa-times mr-2"></i>Fechar
                </button>
            </div>
        </div>
    </div>

    <script>
        // Configuration and Constants
        const CONFIG = {
            get currentDateTime() {
                return {
                    utc: '2025-01-23 04:55:23',
                    br: '23/01/2025 04:55:23'
                };
            },
            currentUser: 'VictorCainj',
            dateTimeFormat: {
                year: 'numeric',
                month: '2-digit',
                day: '2-digit',
                hour: '2-digit',
                minute: '2-digit',
                second: '2-digit',
                hour12: false
            }
        };

        // Utility Class
        const utils = {
            formatDate(date, includeTime = true) {
                if (!date) return '';
                const d = new Date(date);
                if (isNaN(d.getTime())) return '';
                
                const day = String(d.getDate()).padStart(2, '0');
                const month = String(d.getMonth() + 1).padStart(2, '0');
                const year = d.getFullYear();
                const hours = String(d.getHours()).padStart(2, '0');
                const minutes = String(d.getMinutes()).padStart(2, '0');
                const seconds = String(d.getSeconds()).padStart(2, '0');
                
                return includeTime 
                    ? `${day}/${month}/${year} ${hours}:${minutes}:${seconds}`
                    : `${day}/${month}/${year}`;
            },

            getCurrentDateTime() {
                return CONFIG.currentDateTime.utc;
            },

            calculateDaysOpen(date) {
                const start = new Date(date);
                const now = new Date();
                const diffTime = Math.abs(now - start);
                return Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            },

            sanitizeInput(input) {
                if (!input) return '';
                return input.toString()
                    .replace(/&/g, '&amp;')
                    .replace(/</g, '&lt;')
                    .replace(/>/g, '&gt;')
                    .replace(/"/g, '&quot;')
                    .replace(/'/g, '&#039;');
            },

            showNotification(message, type = 'success') {
                const notification = document.getElementById('notification');
                notification.textContent = message;
                notification.className = `notification notification-${type}`;
                notification.classList.remove('hidden');
                
                setTimeout(() => {
                    notification.classList.add('hidden');
                }, 3000);
            },

            showLoading(show = true) {
                document.getElementById('loadingSpinner').classList.toggle('hidden', !show);
            },

            debounce(func, wait) {
                let timeout;
                return function executedFunction(...args) {
                    const later = () => {
                        clearTimeout(timeout);
                        func(...args);
                    };
                    clearTimeout(timeout);
                    timeout = setTimeout(later, wait);
                };
            },

            downloadFile(content, filename, contentType) {
                const blob = new Blob([content], { type: contentType });
                const url = window.URL.createObjectURL(blob);
                const link = document.createElement('a');
                link.href = url;
                link.download = filename;
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
                window.URL.revokeObjectURL(url);
            },

validateForm(formData) {
                const errors = [];
                
                if (!formData.contractNumber?.trim()) {
                    errors.push('Número do contrato é obrigatório');
                }
                if (!formData.role?.trim()) {
                    errors.push('Locador/Locatário é obrigatório');
                }
                if (!formData.problem?.trim()) {
                    errors.push('Problema é obrigatório');
                }
                if (!formData.date?.trim()) {
                    errors.push('Data do contrato é obrigatória');
                }
                if (!formData.address?.trim()) {
                    errors.push('Endereço é obrigatório');
                }
                
                return errors;
            }
        };

        // Note Manager Class
        class NoteManager {
            constructor() {
                this.notes = JSON.parse(localStorage.getItem('notes')) || {};
                this.currentNote = null;
                this.initializeEventListeners();
                this.renderNotes();
            }

            initializeEventListeners() {
                // Create Note
                document.getElementById('createNoteBtn').addEventListener('click', () => this.showNoteModal());
                
                // Form Submission
                document.getElementById('noteForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.handleNoteSubmission();
                });

                // Modal Controls
                document.getElementById('cancelBtn').addEventListener('click', () => this.hideNoteModal());
                document.getElementById('closeDetailsBtn').addEventListener('click', () => this.hideNoteDetailsModal());
                
                // Search and Filters
                document.getElementById('searchInput').addEventListener('input', 
                    utils.debounce(() => this.renderNotes(), 300)
                );
                document.getElementById('dateSort').addEventListener('change', () => this.renderNotes());
                document.getElementById('statusFilter').addEventListener('change', () => this.renderNotes());

                // Import/Export
                document.getElementById('importNotesBtn').addEventListener('click', () => {
                    document.getElementById('fileInput').click();
                });
                document.getElementById('fileInput').addEventListener('change', (e) => this.importNotes(e));
                document.getElementById('downloadNotesBtn').addEventListener('click', () => this.exportNotes());

                // Note Details Actions
                document.getElementById('toggleStatusBtn').addEventListener('click', () => this.toggleNoteStatus());
                document.getElementById('deleteNoteBtn').addEventListener('click', () => this.deleteNote());
                document.getElementById('copyDetailsBtn').addEventListener('click', () => this.copyNoteDetails());
                document.getElementById('downloadContractBtn').addEventListener('click', () => this.downloadCurrentNote());
                
                // Comments
                document.getElementById('commentForm').addEventListener('submit', (e) => {
                    e.preventDefault();
                    this.addComment();
                });

                // Update current date/time display
                setInterval(() => {
                    const dateTimeDisplay = document.getElementById('currentDateTime');
                    if (dateTimeDisplay) {
                        const currentDateTime = CONFIG.currentDateTime;
                        dateTimeDisplay.textContent = currentDateTime.utc; // Using UTC format for display
                    }
                }, 1000);
            }

            showNoteModal(note = null) {
                this.currentNote = note;
                const modal = document.getElementById('noteModal');
                const form = document.getElementById('noteForm');
                
                if (note) {
                    document.getElementById('contractNumber').value = note.contractNumber;
                    document.getElementById('role').value = note.role;
                    document.getElementById('problem').value = note.problem;
                    document.getElementById('date').value = note.date.split(' ')[0];
                    document.getElementById('address').value = note.address;
                } else {
                    form.reset();
                }
                
                modal.classList.remove('hidden');
            }

            hideNoteModal() {
                document.getElementById('noteModal').classList.add('hidden');
                document.getElementById('noteForm').reset();
                this.currentNote = null;
            }

            handleNoteSubmission() {
                const formData = {
                    contractNumber: document.getElementById('contractNumber').value.trim(),
                    role: document.getElementById('role').value.trim(),
                    problem: document.getElementById('problem').value.trim(),
                    date: document.getElementById('date').value,
                    address: document.getElementById('address').value.trim()
                };

                const errors = utils.validateForm(formData);
                if (errors.length > 0) {
                    utils.showNotification(errors.join('\n'), 'error');
                    return;
                }

                const noteData = {
                    ...formData,
                    date: `${formData.date} ${CONFIG.currentDateTime.utc.split(' ')[1]}`,
                    status: this.currentNote?.status || 'open',
                    comments: this.currentNote?.comments || []
                };

                this.notes[formData.contractNumber] = noteData;
                this.saveNotes();
                this.hideNoteModal();
                this.renderNotes();
                
                utils.showNotification(
                    this.currentNote ? 'Anotação atualizada com sucesso!' : 'Anotação criada com sucesso!'
                );
            }

            showNoteDetailsModal(contractNumber) {
                const note = this.notes[contractNumber];
                if (!note) return;

                this.currentNote = note;
                const modal = document.getElementById('noteDetailsModal');
                const content = document.getElementById('noteDetailsContent');
                const toggleStatusBtn = document.getElementById('toggleStatusBtn');

                content.innerHTML = `
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <p class="font-semibold">Número do Contrato</p>
                            <p>${utils.sanitizeInput(note.contractNumber)}</p>
                        </div>
                        <div>
                            <p class="font-semibold">Status</p>
                            <p>${note.status === 'open' ? 'Em aberto' : 'Finalizado'}</p>
                        </div>
                        <div>
                            <p class="font-semibold">Locador/Locatário</p>
                            <p>${utils.sanitizeInput(note.role)}</p>
                        </div>
                        <div>
                            <p class="font-semibold">Data do Contrato</p>
                            <p>${utils.formatDate(note.date)}</p>
                        </div>
                        <div class="col-span-2">
                            <p class="font-semibold">Endereço</p>
                            <p>${utils.sanitizeInput(note.address)}</p>
                        </div>
                        <div class="col-span-2">
                            <p class="font-semibold">Problema</p>
                            <p>${utils.sanitizeInput(note.problem)}</p>
                        </div>
                    </div>
                `;

                toggleStatusBtn.innerHTML = `
                    <i class="fas fa-${note.status === 'open' ? 'check-circle' : 'undo'} mr-2"></i>
                    ${note.status === 'open' ? 'Finalizar' : 'Reabrir'} Chamado
                `;
                toggleStatusBtn.className = `btn ${note.status === 'open' ? 'btn-green' : 'btn-yellow'} flex-1`;

                this.renderComments();
                modal.classList.remove('hidden');
            }

            hideNoteDetailsModal() {
                document.getElementById('noteDetailsModal').classList.add('hidden');
                this.currentNote = null;
            }

            toggleNoteStatus() {
                if (!this.currentNote) return;

                const note = this.notes[this.currentNote.contractNumber];
                note.status = note.status === 'open' ? 'closed' : 'open';
                this.saveNotes();
                this.showNoteDetailsModal(note.contractNumber);
                this.renderNotes();
                
                utils.showNotification(
                    `Chamado ${note.status === 'closed' ? 'finalizado' : 'reaberto'} com sucesso!`
                );
            }

            deleteNote() {
                if (!this.currentNote) return;

                if (confirm('Tem certeza que deseja excluir esta anotação?')) {
                    delete this.notes[this.currentNote.contractNumber];
                    this.saveNotes();
                    this.hideNoteDetailsModal();
                    this.renderNotes();
                    utils.showNotification('Anotação excluída com sucesso!');
                }
            }

            addComment() {
                if (!this.currentNote) return;

                const commentText = document.getElementById('commentText').value.trim();
                if (!commentText) return;

                const comment = {
                    text: commentText,
                    date: CONFIG.currentDateTime.utc,
                    user: CONFIG.currentUser
                };

                this.notes[this.currentNote.contractNumber].comments.push(comment);
                this.saveNotes();
                this.renderComments();
                
                document.getElementById('commentText').value = '';
                utils.showNotification('Comentário adicionado com sucesso!');
            }

            renderComments() {
                if (!this.currentNote) return;

                const container = document.getElementById('commentsContainer');
                const comments = this.notes[this.currentNote.contractNumber].comments;
                
                container.innerHTML = comments.length ? comments.map(comment => `
                    <div class="comment-box">
                        <div class="flex justify-between items-start">
                            <span class="font-semibold">${utils.sanitizeInput(comment.user)}</span>
                            <span class="text-sm text-gray-500">${utils.formatDate(comment.date)}</span>
                        </div>
                        <p class="mt-2">${utils.sanitizeInput(comment.text)}</p>
                    </div>
                `).join('') : '<p class="text-gray-500">Nenhum comentário ainda.</p>';
            }

            renderNotes() {
                const container = document.getElementById('notesContainer');
                const searchTerm = document.getElementById('searchInput').value.toLowerCase();
                const dateSort = document.getElementById('dateSort').value;
                const statusFilter = document.getElementById('statusFilter').value;

                let filteredNotes = Object.entries(this.notes)
                    .filter(([_, note]) => {
                        const matchesSearch = (
                            note.contractNumber.toLowerCase().includes(searchTerm) ||
                            note.role.toLowerCase().includes(searchTerm) ||
                            note.address.toLowerCase().includes(searchTerm) ||
                            note.problem.toLowerCase().includes(searchTerm)
                        );
                        const matchesStatus = statusFilter === 'all' || note.status === statusFilter;
                        return matchesSearch && matchesStatus;
                    })
                    .sort(([_, a], [__, b]) => {
                        const dateA = new Date(a.date);
                        const dateB = new Date(b.date);
                        return dateSort === 'newest' ? dateB - dateA : dateA - dateB;
                    });

                container.innerHTML = filteredNotes.length ? filteredNotes.map(([contractNumber, note]) => `
                    <div class="bg-white p-4 rounded-lg shadow-sm cursor-pointer hover:shadow-md transition-shadow"
                         data-contract="${contractNumber}"
                         onclick="noteManager.showNoteDetailsModal('${contractNumber}')">
                        <span class="block font-bold">#${utils.sanitizeInput(contractNumber)}</span>
                        <span class="block text-sm">${utils.sanitizeInput(note.role)}</span>
                        <span class="block text-xs mt-1">${utils.formatDate(note.date, false)}</span>
                        <span class="block text-xs mt-1">
                            ${note.status === 'open' 
                                ? `Em aberto há ${utils.calculateDaysOpen(note.date)} dias` 
                                : 'Finalizado'}
                        </span>
                        <span class="block text-xs opacity-75 mt-1">${note.comments.length} comentário(s)</span>
                    </div>
                `).join('') : `
                    <div class="col-span-full text-center text-gray-500 py-8">
                        Nenhuma anotação encontrada.
                    </div>
                `;
            }

            saveNotes() {
                localStorage.setItem('notes', JSON.stringify(this.notes));
            }

            exportNotes() {
                const data = JSON.stringify(this.notes, null, 2);
                const filename = `notas_${utils.formatDate(CONFIG.currentDateTime.utc).replace(/[/:\s]/g, '-')}.json`;
                utils.downloadFile(data, filename, 'application/json');
                utils.showNotification('Dados exportados com sucesso!');
            }

            importNotes(event) {
                const file = event.target.files[0];
                if (!file) return;

                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const importedNotes = JSON.parse(e.target.result);
                        this.notes = { ...this.notes, ...importedNotes };
                        this.saveNotes();
                        this.renderNotes();
                        utils.showNotification('Dados importados com sucesso!');
                    } catch (error) {
                        utils.showNotification('Erro ao importar arquivo: formato inválido', 'error');
                    }
                };
                reader.readAsText(file);
                event.target.value = '';
            }

            copyNoteDetails() {
                if (!this.currentNote) return;

                const note = this.currentNote;
                const details = `
                    Número do Contrato: ${note.contractNumber}
                    Locador/Locatário: ${note.role}
                    Data do Contrato: ${utils.formatDate(note.date)}
                    Endereço: ${note.address}
                    Status: ${note.status === 'open' ? 'Em aberto' : 'Finalizado'}
                    Problema: ${note.problem}
                    
                    Comentários:
                    ${note.comments.map(comment => 
                        `[${utils.formatDate(comment.date)}] ${comment.user}: ${comment.text}`
                    ).join('\n')}
                `.trim();

                navigator.clipboard.writeText(details)
                    .then(() => utils.showNotification('Dados copiados para a área de transferência!'))
                    .catch(() => utils.showNotification('Erro ao copiar dados', 'error'));
            }

            downloadCurrentNote() {
                if (!this.currentNote) return;

                const note = this.currentNote;
                const data = JSON.stringify({ [note.contractNumber]: note }, null, 2);
                const filename = `contrato_${note.contractNumber}_${utils.formatDate(CONFIG.currentDateTime.utc).replace(/[/:\s]/g, '-')}.json`;
                utils.downloadFile(data, filename, 'application/json');
                utils.showNotification('Contrato exportado com sucesso!');
            }
        }

        // Initialize the application
        const noteManager = new NoteManager();

        // Add error boundary
        window.addEventListener('error', (event) => {
            console.error('Erro na aplicação:', event.error);
            utils.showNotification('Ocorreu um erro na aplicação', 'error');
        });

        // Initialize date and user displays
document.addEventListener('DOMContentLoaded', () => {
            const dateTimeDisplay = document.getElementById('currentDateTime');
            const userDisplay = document.getElementById('currentUser');
            
            if (dateTimeDisplay) {
                dateTimeDisplay.textContent = '2025-01-23 04:58:24'; // UTC format
            }
            
            if (userDisplay) {
                userDisplay.textContent = 'VictorCainj';
            }
        });

        // Add keyboard shortcuts
        document.addEventListener('keydown', (e) => {
            // Ctrl/Cmd + N: New Note
            if ((e.ctrlKey || e.metaKey) && e.key === 'n') {
                e.preventDefault();
                noteManager.showNoteModal();
            }
            
            // Esc: Close Modal
            if (e.key === 'Escape') {
                const modals = document.querySelectorAll('.modal-overlay:not(.hidden)');
                modals.forEach(modal => {
                    if (modal.id === 'noteModal') {
                        noteManager.hideNoteModal();
                    } else if (modal.id === 'noteDetailsModal') {
                        noteManager.hideNoteDetailsModal();
                    }
                });
            }
        });

        // Add drag and drop support
        const dropZone = document.body;

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            e.stopPropagation();
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            e.stopPropagation();

            const files = Array.from(e.dataTransfer.files);
            const jsonFiles = files.filter(file => file.type === 'application/json');

            if (jsonFiles.length > 0) {
                const event = { target: { files: [jsonFiles[0]] } };
                noteManager.importNotes(event);
            } else {
                utils.showNotification('Por favor, arraste apenas arquivos JSON', 'error');
            }
        });

        // Add periodic auto-save
        setInterval(() => {
            noteManager.saveNotes();
        }, 300000); // Auto-save every 5 minutes

        // Add unsaved changes warning
        window.addEventListener('beforeunload', (e) => {
            const noteForm = document.getElementById('noteForm');
            const commentForm = document.getElementById('commentForm');
            
            if (!noteForm.classList.contains('hidden') && noteForm.checkValidity()) {
                e.preventDefault();
                e.returnValue = '';
            }
            
            if (!commentForm.classList.contains('hidden') && commentForm.checkValidity()) {
                e.preventDefault();
                e.returnValue = '';
            }
        });

        // Initialize tooltips
        const tooltips = document.querySelectorAll('[data-tooltip]');
        tooltips.forEach(tooltip => {
            tooltip.addEventListener('mouseenter', (e) => {
                const tooltipText = e.target.getAttribute('data-tooltip');
                const tooltipEl = document.createElement('div');
                tooltipEl.className = 'tooltip';
                tooltipEl.textContent = tooltipText;
                document.body.appendChild(tooltipEl);
                
                const rect = e.target.getBoundingClientRect();
                tooltipEl.style.top = `${rect.bottom + 5}px`;
                tooltipEl.style.left = `${rect.left + (rect.width - tooltipEl.offsetWidth) / 2}px`;
            });
            
            tooltip.addEventListener('mouseleave', () => {
                const tooltipEl = document.querySelector('.tooltip');
                if (tooltipEl) tooltipEl.remove();
            });
        });

        // Add support for file attachments (base64 encoded)
        function handleFileAttachment(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = () => reject(reader.error);
                reader.readAsDataURL(file);
            });
        }
    </script>
</body>
</html>
            if (dateTimeDisplay) {
                dateTimeDisplay.textContent = '2025-01-23 04:56:53'; // UTC format
            }
            
            if
